Object.defineProperty(exports,"__esModule",{value:1});var e=require("htmlparser2"),t=require("@libs/fetch"),a=require("@libs/novelStatus"),l=require("@libs/filterInputs"),r=function(){function r(){this.id="ellotl",this.name="ElloTL",this.icon="src/en/ellotl/icon.png",this.site="https://ellotl.com",this.version="1.0.0",this.filters={genres:{type:l.FilterTypes.CheckboxGroup,label:"Genres",value:[],options:[{label:"Action",value:"action"},{label:"Adventure",value:"adventure"},{label:"Comedy",value:"comedy"},{label:"Drama",value:"drama"},{label:"Ecchi",value:"ecchi"},{label:"Fantasy",value:"fantasy"},{label:"Gender Bender",value:"gender-bender"},{label:"Harem",value:"harem"},{label:"Martial Arts",value:"martial-arts"},{label:"Mature",value:"mature"},{label:"Mystery",value:"mystery"},{label:"Psychological",value:"psychological"},{label:"Romance",value:"romance"},{label:"School Life",value:"school-life"},{label:"Seinen",value:"seinen"},{label:"Shounen",value:"shounen"},{label:"Slice of Life",value:"slice-of-life"},{label:"Supernatural",value:"supernatural"},{label:"Tragedy",value:"tragedy"}]},type:{type:l.FilterTypes.CheckboxGroup,label:"Type",value:[],options:[{label:"Japanese Web Novel",value:"japanese-web-novel"},{label:"Korean Web Novel",value:"korean-web-novel"},{label:"Light Novel (JP)",value:"light-novel-jp"},{label:"Web Novel",value:"web-novel"}]},status:{type:l.FilterTypes.Picker,label:"Status",value:"",options:[{label:"All",value:""},{label:"Ongoing",value:"ongoing"},{label:"Hiatus",value:"hiatus"},{label:"Completed",value:"completed"}]},sort:{type:l.FilterTypes.Picker,label:"Sort",value:"popular",options:[{label:"Popular",value:"popular"},{label:"A-Z",value:"title"},{label:"Z-A",value:"titlereverse"},{label:"Latest Update",value:"update"},{label:"Latest Added",value:"latest"},{label:"Rating",value:"rating"}]}}}return r.prototype.parseNovels=function(t){return fetch(t).then((function(e){return e.text()})).then((function(t){var a=0,l={},r=[],n=new e.Parser({onopentag:function(e,t){var n;if((null===(n=t.class)||void 0===n?void 0:n.includes("maindet"))&&(a=1),a){switch(e){case"a":l.path=t.href.replace("https://ellotl.com","").trim();break;case"img":l.name=t.title,l.cover=t.src}l.path&&l.name&&(r.push(l),l={},a=0)}}});return n.write(t),n.end(),r}))},r.prototype.popularNovels=function(e,t){var a=t.showLatestNovels,l=t.filters,r=this.site+"/series";if(a)r+="/?order=update&page="+e;else if(l){for(var n=new URLSearchParams,s=0,o=l.genres.value;s<o.length;s++){var u=o[s];n.append("genre[]",u)}for(var i=0,c=l.type.value;i<c.length;i++){var v=c[i];n.append("type[]",v)}n.append("status",l.status.value),n.append("order",l.sort.value),r+="/?"+n.toString()+"&page="+e}else r+="/?page="+e;return this.parseNovels(r)},r.prototype.parseNovel=function(t){return fetch(this.site+t).then((function(e){return e.text()})).then((function(l){var r;function n(e,t){var a=e.match(/(\d+)$/);null!==a&&(t.chapterNumber=parseInt(a[0]))}var s={path:t,name:"",genres:"",summary:"",author:"",status:"",chapters:[]},o=0,u=0,i=0,c=0,v=0,p=0,h=0,d=0,b=0,m=0,f=[],g={},y=new e.Parser({onopentag:function(e,t){var a;!s.cover&&(null===(a=t.class)||void 0===a?void 0:a.includes("ts-post-image"))?(s.name=t.title,s.cover=t.src):"genxed"===t.class?o=1:o&&"a"===e?u=1:"entry-content"===t.class?i=1:"spe"===t.class?c=1:c&&"span"===e?v=1:"eplister eplisterfull"===t.class?d=1:d&&"li"===e?b=1:b&&("a"===e?g.path=t.href.replace("https://ellotl.com","").trim():"epl-num"===t.class?m=1:"epl-title"===t.class?m=2:"epl-date"===t.class&&(m=3))},ontext:function(e){var t,a;o?u&&(s.genres+=e+", "):i?s.summary+=e.trim():c?v&&("Author:"===e?p=1:"Status:"===e?h=1:p?s.author+=e:h&&(s.status=e)):d&&b&&(1===m?n(e,g):2===m?(g.name=(null===(a=null===(t=e.match(RegExp("^".concat(s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\s*(.+)"))))||void 0===t?void 0:t[1])||void 0===a?void 0:a.trim())||e.trim(),g.chapterNumber||n(e,g)):3===m&&(g.releaseTime=e))},onclosetag:function(e){var t,a,l;o?u?u=0:(o=0,s.genres=null===(t=s.genres)||void 0===t?void 0:t.replace(/,*\s*$/,"")):i?"br"===e?s.summary+="\n":"div"===e&&(i=0):c?v?"span"===e&&(v=0,p?p=0:h&&(h=0)):"div"===e&&(c=0,s.author=null===(a=s.author)||void 0===a?void 0:a.trim(),s.status=null===(l=s.status)||void 0===l?void 0:l.trim()):d&&(b?1===m||2===m||3===m?m=0:"li"===e&&(b=0,g.chapterNumber||(g.chapterNumber=0),f.push(g),g={}):"ul"===e&&(d=0,s.chapters=f.reverse()))}});switch(y.write(l),y.end(),null===(r=s.status)||void 0===r?void 0:r.trim()){case"Ongoing":s.status=a.NovelStatus.Ongoing;break;case"Hiatus":s.status=a.NovelStatus.OnHiatus;break;case"Completed":s.status=a.NovelStatus.Completed;break;default:s.status=a.NovelStatus.Unknown}return s}))},r.prototype.parseChapter=function(t){return fetch(this.site+t).then((function(e){return e.text()})).then((function(t){var a=0,l=0,r=0,n=0,s="",o=0,u=new e.Parser({onopentag:function(e,t){var u,i,c;if((null===(u=t.class)||void 0===u?void 0:u.includes("epheader"))&&(s+="<h2>",a=1,l=1),r&&(s+=" | "),(null===(i=t.class)||void 0===i?void 0:i.includes("entry-content"))&&(n=1),n&&!o){for(var v in s+="<".concat(e),t)s+=" ".concat(v,'="').concat(t[v],'"');s+=">"}(null===(c=t.class)||void 0===c?void 0:c.includes("mb-center"))&&(o=1)},ontext:function(e){l&&(s+=e),r&&(s+=e),n&&!o&&(s+=e)},onclosetag:function(e){l&&"h1"===e&&(l=0,r=1),r&&"div"===e&&(r=0),!a||l||r||(s+="</h2><br>",a=0),n&&!o&&(s+="</".concat(e,">")),o&&"span"===e&&(o=0),n&&"div"===e&&(n=0)}});return u.write(t),u.end(),s.trim()}))},r.prototype.searchNovels=function(e,t){var a=this.site+"/?s="+e+"&page="+t;return this.parseNovels(a)},r.prototype.fetchImage=function(e){return(0,t.fetchFile)(e)},r}();exports.default=new r;