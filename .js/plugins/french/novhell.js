var e=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:0};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:1});var r=require("cheerio"),i=require("@libs/fetch"),n=require("@libs/defaultCover"),o=require("@libs/novelStatus"),a=function(){function a(){this.id="novhell",this.name="Novhell",this.icon="src/fr/novhell/icon.png",this.site="https://novhell.org",this.version="1.0.0",this.filters=void 0}return a.prototype.getCheerio=function(n){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,(0,i.fetchApi)(n,{headers:{"Accept-Encoding":"deflate"}})];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),[2,(0,r.load)(e)]}}))}))},a.prototype.popularNovels=function(r,i){i.showLatestNovels,i.filters;return e(this,void 0,void 0,(function(){var e,i,n,o,a=this;return t(this,(function(t){switch(t.label){case 0:return r>1?[2,[]]:(e=[],n=this.site,[4,this.getCheerio(n)]);case 1:return(o=t.sent())("article div div div figure").each((function(t,r){var n=o(r).find("figcaption span strong").first().text().trim();n&&""!==n.trim()||(n=o(r).find("figcaption a strong").first().text().trim());var s=o(r).find("a img").attr("src"),c=o(r).find("a").attr("href");c&&n&&(i={name:n,cover:s,path:c.replace(a.site,"")},e.push(i))})),[2,e]}}))}))},a.prototype.parseNovel=function(r){var i;return e(this,void 0,void 0,(function(){var e,a,s,c=this;return t(this,(function(t){switch(t.label){case 0:return e={path:r,name:"Sans titre"},[4,this.getCheerio(this.site+r)];case 1:return a=t.sent(),e.name=(null===(i=a('meta[property="og:title"]').attr("content"))||void 0===i?void 0:i.replace("- NovHell",""))||"",e.cover=a("section div div div div div img").first().attr("src")||n.defaultCover,e.status=o.NovelStatus.Ongoing,e.author=a("strong:contains('Ecrit par ')").parent().text().replace("Ecrit par ","").trim(),e.author||(e.author=a("div p:contains('Auteur')").text().replace("Auteur","").replace(":","").trim()),e.author||(e.author=a("div p:contains('Ecrit par :')").text().replace("Ecrit par :","").trim()),e.genres=a("strong:contains('Genre')").parent().text().replace("Genre","").replace(":","").trim(),e.genres||(e.genres=a("div p:contains('Genre')").text().replace("Genre","").replace(":","").trim()),e.summary=a("strong:contains('Synopsis')").parent().parent().text().replace("Synopsis","").replace("Synopsis","").replace(":","").trim(),s=[],a("main div article div div section div div div div div p a").each((function(e,t){var r=a(t).text().replace(/\u00A0/g," ").trim(),i=a(t).attr("href");if(i&&i.includes(c.site)){for(var n=/Chapitre (\d+)/g,o=0,u=void 0;null!==(u=n.exec(r));){o+=parseInt(u[1])}s.push({name:r,path:i.replace(c.site,""),chapterNumber:o})}})),e.chapters=s.sort((function(e,t){return void 0!==e.chapterNumber&&void 0!==t.chapterNumber?e.chapterNumber-t.chapterNumber:void 0===e.chapterNumber?1:-1})),[2,e]}}))}))},a.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e,i,n,o,a;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+r)];case 1:return e=t.sent(),(i=e("main article div div section"))&&(n=i.length,o=i.eq(n-3),a=i.eq(n-2),o&&a)?[2,(o.html()||"")+(a.html()||"")]:[2,""]}}))}))},a.prototype.searchNovels=function(r,i){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return 1!==i?[2,[]]:[4,this.popularNovels(1,{showLatestNovels:1,filters:void 0})];case 1:return[2,e.sent().filter((function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().includes(r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim())}))]}}))}))},a.prototype.fetchImage=function(r){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,(0,i.fetchFile)(r)]}))}))},a}();exports.default=new a;