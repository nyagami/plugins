var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function l(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,l)}c((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:0};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:1}}([l,c])}}};Object.defineProperty(exports,"__esModule",{value:1});var r=require("cheerio"),n=require("@libs/fetch"),a=require("@libs/filterInputs"),o=require("@libs/novelStatus"),i=function(){function i(){this.id="linovelib",this.name="Linovelib",this.icon="src/cn/linovelib/icon.png",this.site="https://www.bilinovel.com",this.version="1.1.2",this.filters={rank:{label:"排行榜",value:"monthvisit",options:[{label:"月点击榜",value:"monthvisit"},{label:"周点击榜",value:"weekvisit"},{label:"月推荐榜",value:"monthvote"},{label:"周推荐榜",value:"weekvote"},{label:"月鲜花榜",value:"monthflower"},{label:"周鲜花榜",value:"weekflower"},{label:"月鸡蛋榜",value:"monthegg"},{label:"周鸡蛋榜",value:"weekegg"},{label:"最近更新",value:"lastupdate"},{label:"最新入库",value:"postdate"},{label:"收藏榜",value:"goodnum"},{label:"新书榜",value:"newhot"}],type:a.FilterTypes.Picker}}}return i.prototype.popularNovels=function(a,o){var i=o.showLatestNovels,l=o.filters;return e(this,void 0,void 0,(function(){var e,o,c,s,u;return t(this,(function(t){switch(t.label){case 0:return e=i?"lastupdate":l.rank.value,o="".concat(this.site,"/top/").concat(e,"/").concat(a,".html"),[4,(0,n.fetchText)(o)];case 1:if(""===(c=t.sent()))throw Error("无法获取小说列表，请检查网络");return s=(0,r.load)(c),u=[],s(".module-rank-booklist .book-layout").each((function(e,t){var r=s(t).attr("href"),n=s(t).find(".book-title").text(),a=s(t).find("div.book-cover > img").attr("data-src");if(r){var o={name:n,cover:a,path:r};u.push(o)}})),[2,u]}}))}))},i.prototype.parseNovel=function(a){var i;return e(this,void 0,void 0,(function(){var e,l,c,s,u,h,v,f,p,b,d,m,g;return t(this,(function(t){switch(t.label){case 0:return e=this.site+a,[4,(0,n.fetchText)(e)];case 1:if(""===(l=t.sent()))throw Error("无法获取小说内容，请检查网络");return c=(0,r.load)(l),(s={path:a,chapters:[],name:c("#bookDetailWrapper .book-title").text()}).cover=c("#bookDetailWrapper img.book-cover").attr("src"),s.summary=c("#bookSummary content").text(),s.author=c("#bookDetailWrapper .book-rand-a a").text(),u=c("#bookDetailWrapper .book-meta").text(),s.status=u.includes("完结")?o.NovelStatus.Completed:o.NovelStatus.Ongoing,s.genres=c(".tag-small.red").children("a").map((function(e,t){return c(t).text()})).toArray().join(","),h=[],v=/\/(\d+)\.html/,f=null===(i=e.match(v))||void 0===i?void 0:i[1],p=this.site+c("#btnReadBook").attr("href"),[4,(0,n.fetchText)(p)];case 2:return b=t.sent(),(d=(0,r.load)(b))("#volumes .chapter-li:not(.volume-cover)").each((function(e,t){if(d(t).hasClass("chapter-bar"))m=d(t).text();else{var r=d(t).find(".chapter-li-a").attr("href"),n=null==r?void 0:r.match(v);n?g=+n[1]:g++;var a="/novel/".concat(f,"/").concat(g,".html"),o=m+" — "+d(t).find(".chapter-index").text().trim();g&&h.push({name:o,releaseTime:null,path:a})}})),s.chapters=h,[2,s]}}))}))},i.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var o,i,l,c,s,u,h,v,f,p,b,d,m=this;return t(this,(function(g){switch(g.label){case 0:i="",s="",u=1,h={"“":"「","”":"」","‘":"『","’":"』","":"的","":"一","":"是","":"了","":"我","":"不","":"人","":"在","":"他","":"有","":"这","":"个","":"上","":"们","":"来","":"到","":"时","":"大","":"地","":"为","":"子","":"中","":"你","":"说","":"生","":"国","":"年","":"着","":"就","":"那","":"和","":"要","":"她","":"出","":"也","":"得","":"里","":"后","":"自","":"以","":"会","":"家","":"可","":"下","":"而","":"过","":"天","":"去","":"能","":"对","":"小","":"多","":"然","":"于","":"心","":"学","":"么","":"之","":"都","":"好","":"看","":"起","":"发","":"当","":"没","":"成","":"只","":"如","":"事","":"把","":"还","":"用","":"第","":"样","":"道","":"想","":"作","":"种","":"开","":"美","":"乳","":"阴","":"液","":"茎","":"欲","":"呻","":"肉","":"交","":"性","":"胸","":"私","":"穴","":"淫","":"臀","":"舔","":"射","":"脱","":"裸","":"骚","":"唇"},v=function(r){return e(m,void 0,void 0,(function(){var n=this;return t(this,(function(a){switch(a.label){case 0:return[4,function(){return e(n,void 0,void 0,(function(){return t(this,(function(e){return r("#acontentz .adsbygoogle").remove(),r("#acontentz script").remove(),r("#acontentz img.imagecontent").each((function(e,t){var n=r(t).attr("data-src")||r(t).attr("src");n&&r(t).attr("src",n).removeAttr("data-src").removeClass("lazyload")})),s=(s=r("#acontentz").html()||"").replace(/./g,(function(e){return h[e]||e})),[2,Promise.resolve()]}))}))}()];case 1:return a.sent(),o=r("#atitle + h3").text()+" — "+r("#atitle").text(),""===i&&(i="<h2>"+o+"</h2>"),i+=s,[2]}}))}))},f=function(a){return e(m,void 0,void 0,(function(){var e,o,i;return t(this,(function(t){switch(t.label){case 0:return e={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"zh-CN,zh;q=0.9,zh-TW;q=0.8,zh-HK;q=0.7,en;q=0.6,en-GB;q=0.5,en-US;q=0.4","Cache-Control":"no-cache"},[4,(0,n.fetchText)(a,{headers:e})];case 1:return o=t.sent(),i=(0,r.load)(o),[4,v(i)];case 2:return t.sent(),c="下一页"===i("#footlink a:last").text()||"下一頁"===i("#footlink a:last").text()?1:0,[2,{pageCheerio:i,pageHasNextPage:c}]}}))}))},p=this.site+a,b=p,g.label=1;case 1:return[4,f(p)];case 2:d=g.sent(),1==(l=d.pageHasNextPage)&&(u++,p=b.replace(/\.html/gi,"_".concat(u)+".html")),g.label=3;case 3:if(1==l)return[3,1];g.label=4;case 4:return[2,i]}}))}))},i.prototype.searchNovels=function(a,o){return e(this,void 0,void 0,(function(){var e,i,l,c;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site,"/search/").concat(encodeURI(a),"_").concat(o,".html"),[4,(0,n.fetchText)(e)];case 1:if(""===(i=t.sent()))throw Error("无法获取搜索结果，请检查网络");return l=(0,r.load)(i),c=[],l(".book-ol .book-layout").each((function(e,t){var r=l(t).attr("href"),n=l(t).find(".book-title").text(),a=l(t).find("div.book-cover > img").attr("data-src");r&&c.push({name:n,path:r,cover:a})})),[2,c]}}))}))},i.prototype.fetchImage=function(r){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return e=new Headers({Referer:"".concat(this.site,"/")}),[4,(0,n.fetchFile)(r,{headers:e})];case 1:return[2,t.sent()]}}))}))},i}();exports.default=new i;